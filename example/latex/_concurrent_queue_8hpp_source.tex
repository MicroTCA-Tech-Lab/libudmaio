\hypertarget{_concurrent_queue_8hpp_source}{}\doxysection{Concurrent\+Queue.\+hpp}
\label{_concurrent_queue_8hpp_source}\index{ConcurrentQueue.hpp@{ConcurrentQueue.hpp}}
\mbox{\hyperlink{_concurrent_queue_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\///}}
\DoxyCodeLine{2 \textcolor{comment}{//        \_\_\_\_  \_\_\_\_\_\_\_\_\_\_\_\_\_  \_\_    \_\_  \_\_ \_           \_\_\_\_\_ \_\_\_   \_        //}}
\DoxyCodeLine{3 \textcolor{comment}{//       / \_\_ \(\backslash\)/ \_\_\_\_/ \_\_\_/\(\backslash\) \(\backslash\)/ /   |  \(\backslash\)/  (\_)\_\_ \_ \_ \_\_|\_   \_/ \_\_| /\_\(\backslash\)       //}}
\DoxyCodeLine{4 \textcolor{comment}{//      / / / / \_\_/  \(\backslash\)\_\_ \(\backslash\)  \(\backslash\)  /    | |\(\backslash\)/| | / \_| '\_/ \_ \(\backslash\)| || (\_\_ / \_ \(\backslash\)      //}}
\DoxyCodeLine{5 \textcolor{comment}{//     / /\_/ / /\_\_\_ \_\_\_/ /  / /     |\_|  |\_|\_\(\backslash\)\_\_|\_| \(\backslash\)\_\_\_/|\_| \(\backslash\)\_\_\_/\_/ \(\backslash\)\_\(\backslash\)     //}}
\DoxyCodeLine{6 \textcolor{comment}{//    /\_\_\_\_\_/\_\_\_\_\_//\_\_\_\_/  /\_/      T  E  C  H  N  O  L  O  G  Y   L A B     //}}
\DoxyCodeLine{7 \textcolor{comment}{//                                                                           //}}
\DoxyCodeLine{8 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\///}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{comment}{// Copyright (c) 2021 Deutsches Elektronen-\/Synchrotron DESY}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <chrono>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <condition\_variable>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <queue>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_logging_8hpp}{udmaio/Logging.hpp}}"{}}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceudmaio}{udmaio}} \{}
\DoxyCodeLine{23 }
\DoxyCodeLine{25 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{26 \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_concurrent_queue}{ConcurrentQueue}} : \textcolor{keyword}{public} \mbox{\hyperlink{structudmaio_1_1_logger}{Logger}} \{}
\DoxyCodeLine{27   \textcolor{keyword}{public}:}
\DoxyCodeLine{31     T \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a448333f6da5f44b12586a2b0041354aa}{pop}}(std::chrono::milliseconds timeout = std::chrono::milliseconds\{0\}) \{}
\DoxyCodeLine{32         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}pop..."{}};}
\DoxyCodeLine{33         std::unique\_lock<std::mutex> lock\{\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a30d6a2c6aaaf69eb5ee501526f3f7353}{\_mutex}}\};}
\DoxyCodeLine{34         \textcolor{keywordflow}{while} (\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aa5b3c888ba18a51132f6c68006b7bea5}{\_queue}}.empty()) \{}
\DoxyCodeLine{35             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a779c0e38ac39c3f7a44a83202971dc89}{\_abort}}) \{}
\DoxyCodeLine{36                 BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}pop abort"{}};}
\DoxyCodeLine{37                 \textcolor{keywordflow}{return} \{\};}
\DoxyCodeLine{38             \}}
\DoxyCodeLine{39             \textcolor{keywordflow}{if} (timeout.count()) \{}
\DoxyCodeLine{40                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_af3be3bf32dc9f61afe7f92a0b6f948a1}{\_cond}}.wait\_for(lock, timeout) == std::cv\_status::timeout) \{}
\DoxyCodeLine{41                     BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}pop timeout"{}};}
\DoxyCodeLine{42                     \textcolor{keywordflow}{return} \{\};}
\DoxyCodeLine{43                 \}}
\DoxyCodeLine{44             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{45                 \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_af3be3bf32dc9f61afe7f92a0b6f948a1}{\_cond}}.wait(lock);}
\DoxyCodeLine{46             \}}
\DoxyCodeLine{47         \}}
\DoxyCodeLine{48         \textcolor{keyword}{auto} val = std::move(\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aa5b3c888ba18a51132f6c68006b7bea5}{\_queue}}.front());}
\DoxyCodeLine{49         \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aa5b3c888ba18a51132f6c68006b7bea5}{\_queue}}.pop();}
\DoxyCodeLine{50         lock.unlock();}
\DoxyCodeLine{51         \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_af3be3bf32dc9f61afe7f92a0b6f948a1}{\_cond}}.notify\_one();}
\DoxyCodeLine{52         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}pop done"{}};}
\DoxyCodeLine{53         \textcolor{keywordflow}{return} val;}
\DoxyCodeLine{54     \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{58     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a522ac5797493b721ac95f658a0509320}{push}}(T item) \{}
\DoxyCodeLine{59         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}push..."{}};}
\DoxyCodeLine{60         std::unique\_lock<std::mutex> lock(\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a30d6a2c6aaaf69eb5ee501526f3f7353}{\_mutex}});}
\DoxyCodeLine{61         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aa5b3c888ba18a51132f6c68006b7bea5}{\_queue}}.size() >= \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_afd6c990a383134f9c26082ff4d24b730}{MAX\_ELEMS}}) \{}
\DoxyCodeLine{62             lock.unlock();}
\DoxyCodeLine{63             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}libudmaio: ConcurrentQueue full"{}});}
\DoxyCodeLine{64         \}}
\DoxyCodeLine{65         \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aa5b3c888ba18a51132f6c68006b7bea5}{\_queue}}.push(std::move(item));}
\DoxyCodeLine{66         lock.unlock();}
\DoxyCodeLine{67         \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_af3be3bf32dc9f61afe7f92a0b6f948a1}{\_cond}}.notify\_one();}
\DoxyCodeLine{68         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}push done"{}};}
\DoxyCodeLine{69     \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{72     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aaa86ed0665b6ebeb97a155123ef752ac}{abort}}() \{}
\DoxyCodeLine{73         \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a779c0e38ac39c3f7a44a83202971dc89}{\_abort}} = \textcolor{keyword}{true};}
\DoxyCodeLine{74         \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_af3be3bf32dc9f61afe7f92a0b6f948a1}{\_cond}}.notify\_one();}
\DoxyCodeLine{75     \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a75cf8d931a59b50f50c0e785742ca181}{ConcurrentQueue}}() : \mbox{\hyperlink{structudmaio_1_1_logger}{Logger}}(\textcolor{stringliteral}{"{}Queue"{}}) \{\}}
\DoxyCodeLine{78     \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a6d5f4e8e14dccaf9db9172cc98f5c888}{ConcurrentQueue}}(\textcolor{keyword}{const} \mbox{\hyperlink{classudmaio_1_1_concurrent_queue}{ConcurrentQueue}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{79     \mbox{\hyperlink{classudmaio_1_1_concurrent_queue}{ConcurrentQueue}}\& \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_ab86afd4013a112387ffe213a56fb1f05}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{classudmaio_1_1_concurrent_queue}{ConcurrentQueue}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{80 }
\DoxyCodeLine{81   \textcolor{keyword}{private}:}
\DoxyCodeLine{82     std::queue<T> \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_aa5b3c888ba18a51132f6c68006b7bea5}{\_queue}};}
\DoxyCodeLine{83     std::mutex \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a30d6a2c6aaaf69eb5ee501526f3f7353}{\_mutex}};}
\DoxyCodeLine{84     std::condition\_variable \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_af3be3bf32dc9f61afe7f92a0b6f948a1}{\_cond}};}
\DoxyCodeLine{85     \textcolor{keyword}{constexpr} \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_afd6c990a383134f9c26082ff4d24b730}{MAX\_ELEMS}} = 64;}
\DoxyCodeLine{86     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classudmaio_1_1_concurrent_queue_a779c0e38ac39c3f7a44a83202971dc89}{\_abort}} = \textcolor{keyword}{false};}
\DoxyCodeLine{87 \};}
\DoxyCodeLine{88 }
\DoxyCodeLine{89 \}  \textcolor{comment}{// namespace udmaio}}

\end{DoxyCode}
