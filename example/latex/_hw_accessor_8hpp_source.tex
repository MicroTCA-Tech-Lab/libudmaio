\hypertarget{_hw_accessor_8hpp_source}{}\doxysection{Hw\+Accessor.\+hpp}
\label{_hw_accessor_8hpp_source}\index{HwAccessor.hpp@{HwAccessor.hpp}}
\mbox{\hyperlink{_hw_accessor_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\///}}
\DoxyCodeLine{2 \textcolor{comment}{//        \_\_\_\_  \_\_\_\_\_\_\_\_\_\_\_\_\_  \_\_    \_\_  \_\_ \_           \_\_\_\_\_ \_\_\_   \_        //}}
\DoxyCodeLine{3 \textcolor{comment}{//       / \_\_ \(\backslash\)/ \_\_\_\_/ \_\_\_/\(\backslash\) \(\backslash\)/ /   |  \(\backslash\)/  (\_)\_\_ \_ \_ \_\_|\_   \_/ \_\_| /\_\(\backslash\)       //}}
\DoxyCodeLine{4 \textcolor{comment}{//      / / / / \_\_/  \(\backslash\)\_\_ \(\backslash\)  \(\backslash\)  /    | |\(\backslash\)/| | / \_| '\_/ \_ \(\backslash\)| || (\_\_ / \_ \(\backslash\)      //}}
\DoxyCodeLine{5 \textcolor{comment}{//     / /\_/ / /\_\_\_ \_\_\_/ /  / /     |\_|  |\_|\_\(\backslash\)\_\_|\_| \(\backslash\)\_\_\_/|\_| \(\backslash\)\_\_\_/\_/ \(\backslash\)\_\(\backslash\)     //}}
\DoxyCodeLine{6 \textcolor{comment}{//    /\_\_\_\_\_/\_\_\_\_\_//\_\_\_\_/  /\_/      T  E  C  H  N  O  L  O  G  Y   L A B     //}}
\DoxyCodeLine{7 \textcolor{comment}{//                                                                           //}}
\DoxyCodeLine{8 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\///}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{comment}{// Copyright (c) 2023 Deutsches Elektronen-\/Synchrotron DESY}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <filesystem>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <boost/core/noncopyable.hpp>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <fcntl.h>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <sys/mman.h>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include <sys/stat.h>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <sys/types.h>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_logging_8hpp}{udmaio/Logging.hpp}}"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_uio_config_8hpp}{udmaio/UioConfig.hpp}}"{}}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceudmaio}{udmaio}} \{}
\DoxyCodeLine{32 }
\DoxyCodeLine{34 \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_hw_accessor}{HwAccessor}} : \textcolor{keyword}{public} \mbox{\hyperlink{structudmaio_1_1_logger}{Logger}}, \textcolor{keyword}{private} boost::noncopyable \{}
\DoxyCodeLine{35     \textcolor{keyword}{template} <\textcolor{keyword}{typename} C>}
\DoxyCodeLine{36     \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_reg_accessor_base}{RegAccessorBase}};}
\DoxyCodeLine{37     \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_uio_if}{UioIf}};}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   \textcolor{keyword}{protected}:}
\DoxyCodeLine{40     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}};}
\DoxyCodeLine{41 }
\DoxyCodeLine{42   \textcolor{keyword}{public}:}
\DoxyCodeLine{43     \mbox{\hyperlink{classudmaio_1_1_hw_accessor_ab15ed079f234146e8925d11b8b947b00}{HwAccessor}}();}
\DoxyCodeLine{44     \textcolor{keyword}{virtual} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a0210f9910ba71eb103cb33b829213259}{\string~HwAccessor}}();}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{comment}{// Enable raw register access log}}
\DoxyCodeLine{47     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a844fb69443e5c0bd07585dfb83817eb2}{enable\_debug}}(\textcolor{keywordtype}{bool} enable);}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{keyword}{virtual} uint32\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a60dc5388da0e2b48b2f94bd0212dd8b5}{\_rd32}}(uint32\_t offs) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{50     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a96e134ba31588fee1c49c834ee3955ad}{\_wr32}}(uint32\_t offs, uint32\_t data) = 0;}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     \textcolor{comment}{// Default implementation uses 32 bit accesses}}
\DoxyCodeLine{53     \textcolor{comment}{// Can be overridden by subclass if it supports native 64 bit access}}
\DoxyCodeLine{54     \textcolor{keyword}{virtual} uint64\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a9d3e10b75787c569812ad65da4e893c4}{\_rd64}}(uint32\_t offs) \textcolor{keyword}{const};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \textcolor{comment}{// Default implementation uses 32 bit accesses}}
\DoxyCodeLine{57     \textcolor{comment}{// Can be overridden by subclass if it supports native 64 bit access}}
\DoxyCodeLine{58     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_ad293ca2045227221a5e7e0f102b7c5e7}{\_wr64}}(uint32\_t offs, uint64\_t data);}
\DoxyCodeLine{59 }
\DoxyCodeLine{60     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a96f95649e853ba895a629337c4fad764}{\_rd\_mem32}}(uint32\_t offs, \textcolor{keywordtype}{void}* \_\_restrict\_\_ mem, \textcolor{keywordtype}{size\_t} size) \textcolor{keyword}{const};}
\DoxyCodeLine{61     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a5afe6c29d31cf2501c228cf67c38dafa}{\_rd\_mem64}}(uint32\_t offs, \textcolor{keywordtype}{void}* \_\_restrict\_\_ mem, \textcolor{keywordtype}{size\_t} size) \textcolor{keyword}{const};}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a1cc31dc6415601bcd47fe641bfd1877f}{\_wr\_mem32}}(uint32\_t offs, \textcolor{keyword}{const} \textcolor{keywordtype}{void}* \_\_restrict\_\_ mem, \textcolor{keywordtype}{size\_t} size);}
\DoxyCodeLine{64     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a61e8c3716300168c83877da12fe7ffbd}{\_wr\_mem64}}(uint32\_t offs, \textcolor{keyword}{const} \textcolor{keywordtype}{void}* \_\_restrict\_\_ mem, \textcolor{keywordtype}{size\_t} size);}
\DoxyCodeLine{65 }
\DoxyCodeLine{73     \textcolor{keyword}{template} <\textcolor{keyword}{typename} C>}
\DoxyCodeLine{74     C \mbox{\hyperlink{classudmaio_1_1_hw_accessor_ab52226a091bb09bde417d163384fc645}{\_rd\_reg}}(uint32\_t offs)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{75         \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(C) != 0);}
\DoxyCodeLine{76         \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(C) \% \textcolor{keyword}{sizeof}(uint32\_t) == 0);}
\DoxyCodeLine{77 }
\DoxyCodeLine{78         C result;}
\DoxyCodeLine{79         \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{sizeof}(C) > \textcolor{keyword}{sizeof}(uint32\_t) \&\& \textcolor{keyword}{sizeof}(C) \% \textcolor{keyword}{sizeof}(uint64\_t) == 0) \{}
\DoxyCodeLine{80             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a5afe6c29d31cf2501c228cf67c38dafa}{\_rd\_mem64}}(offs, \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\&result), \textcolor{keyword}{sizeof}(C));}
\DoxyCodeLine{81         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{82             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a96f95649e853ba895a629337c4fad764}{\_rd\_mem32}}(offs, \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\&result), \textcolor{keyword}{sizeof}(C));}
\DoxyCodeLine{83         \}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{86     \}}
\DoxyCodeLine{87 }
\DoxyCodeLine{95     \textcolor{keyword}{template} <\textcolor{keyword}{typename} C>}
\DoxyCodeLine{96     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_aac222be9184b15023222867c139411f3}{\_wr\_reg}}(uint32\_t offs, \textcolor{keyword}{const} C\& value) \{}
\DoxyCodeLine{97         \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(C) != 0);}
\DoxyCodeLine{98         \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(C) \% \textcolor{keyword}{sizeof}(uint32\_t) == 0);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100         \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{sizeof}(C) > \textcolor{keyword}{sizeof}(uint32\_t) \&\& \textcolor{keyword}{sizeof}(C) \% \textcolor{keyword}{sizeof}(uint64\_t) == 0) \{}
\DoxyCodeLine{101             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a61e8c3716300168c83877da12fe7ffbd}{\_wr\_mem64}}(offs, \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\&value), \textcolor{keyword}{sizeof}(C));}
\DoxyCodeLine{102         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{103             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a1cc31dc6415601bcd47fe641bfd1877f}{\_wr\_mem32}}(offs, \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\&value), \textcolor{keyword}{sizeof}(C));}
\DoxyCodeLine{104         \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106         \textcolor{comment}{// Prevent compiler \& CPU from re-\/ordering. Make sure the register is actually written here}}
\DoxyCodeLine{107         \_\_sync\_synchronize();}
\DoxyCodeLine{108     \}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_ab174638715c9af6bda9be9537a30a361}{arm\_interrupt}}();}
\DoxyCodeLine{111     \textcolor{keyword}{virtual} uint32\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a02df3d9435657fd6d17ced25885a902f}{wait\_for\_interrupt}}();}
\DoxyCodeLine{112     \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a97f39c0284f7aa859f034caf0b5ecf1f}{get\_fd\_int}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} -\/1; \}}
\DoxyCodeLine{113     \textcolor{keyword}{virtual} \mbox{\hyperlink{structudmaio_1_1_uio_region}{UioRegion}} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a3995bf6f93a9e9cd4c6aaffd4d9ffa96}{get\_phys\_region}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \{0, 0\}; \}}
\DoxyCodeLine{114     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void}* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a722d56b34c177ab7b2d05664fa74f040}{get\_virt\_mem}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr}; \}}
\DoxyCodeLine{115 \};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{comment}{// Base class for mmap'ed hardware access}}
\DoxyCodeLine{118 \textcolor{keyword}{template} <\textcolor{keyword}{typename} max\_access\_w\textcolor{keywordtype}{id}th\_t>}
\DoxyCodeLine{119 \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap}{HwAccessorMmap}} : \textcolor{keyword}{public} \mbox{\hyperlink{classudmaio_1_1_hw_accessor}{HwAccessor}} \{}
\DoxyCodeLine{120   \textcolor{keyword}{public}:}
\DoxyCodeLine{121     \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a2e29086624d41fb018d686404bc43630}{HwAccessorMmap}}(std::string dev\_path, \mbox{\hyperlink{structudmaio_1_1_uio_region}{UioRegion}} region, uintptr\_t mmap\_offs, \textcolor{keywordtype}{size\_t} access\_offs)}
\DoxyCodeLine{122         : \mbox{\hyperlink{classudmaio_1_1_hw_accessor}{HwAccessor}}(), \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}}\{region\} \{}
\DoxyCodeLine{123         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{HwAccessor::\_lg}}, bls::debug) << \textcolor{stringliteral}{"{}dev name = "{}} << dev\_path;}
\DoxyCodeLine{124 }
\DoxyCodeLine{125         \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}} = ::open(dev\_path.c\_str(), O\_RDWR);}
\DoxyCodeLine{126         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}} < 0) \{}
\DoxyCodeLine{127             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}could not open "{}} + dev\_path);}
\DoxyCodeLine{128         \}}
\DoxyCodeLine{129         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{HwAccessor::\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}fd = "{}} << \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}} << \textcolor{stringliteral}{"{}, size = "{}} << \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}}.\mbox{\hyperlink{structudmaio_1_1_uio_region_ac820f3588c55f13155345aae9e198a32}{size}};}
\DoxyCodeLine{130 }
\DoxyCodeLine{131         \textcolor{comment}{// create memory mapping}}
\DoxyCodeLine{132         \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}} = mmap(NULL, \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}}.\mbox{\hyperlink{structudmaio_1_1_uio_region_ac820f3588c55f13155345aae9e198a32}{size}}, PROT\_READ | PROT\_WRITE, MAP\_SHARED, \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}}, mmap\_offs);}
\DoxyCodeLine{133         \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_abb226e09f75ef2c1cae366f3b30b54c0}{\_access\_mem}} = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}}) + access\_offs);}
\DoxyCodeLine{134 }
\DoxyCodeLine{135         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{HwAccessor::\_lg}}, bls::trace)}
\DoxyCodeLine{136             << \textcolor{stringliteral}{"{}mmap = 0x"{}} << std::hex << mmap\_offs << \textcolor{stringliteral}{"{} -\/> 0x"{}} << \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}} << std::dec;}
\DoxyCodeLine{137 }
\DoxyCodeLine{138         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}} == MAP\_FAILED) \{}
\DoxyCodeLine{139             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}mmap failed for uio "{}} + dev\_path + \textcolor{stringliteral}{"{}: "{}} + strerror(errno));}
\DoxyCodeLine{140         \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{HwAccessor::\_lg}}, bls::trace)}
\DoxyCodeLine{143             << \textcolor{stringliteral}{"{}access offs = 0x"{}} << std::hex << access\_offs << \textcolor{stringliteral}{"{} -\/> 0x"{}} << \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_abb226e09f75ef2c1cae366f3b30b54c0}{\_access\_mem}} << std::dec;}
\DoxyCodeLine{144     \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146     \textcolor{keyword}{virtual} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a3403619d569a9cc79fe611064426d29d}{\string~HwAccessorMmap}}() \{}
\DoxyCodeLine{147         munmap(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}}, \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}}.\mbox{\hyperlink{structudmaio_1_1_uio_region_ac820f3588c55f13155345aae9e198a32}{size}});}
\DoxyCodeLine{148         ::close(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}});}
\DoxyCodeLine{149     \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   \textcolor{keyword}{protected}:}
\DoxyCodeLine{152     \textcolor{keywordtype}{int} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}};}
\DoxyCodeLine{153     \textcolor{keywordtype}{void}* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}};}
\DoxyCodeLine{154     \textcolor{keywordtype}{void}* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_abb226e09f75ef2c1cae366f3b30b54c0}{\_access\_mem}};}
\DoxyCodeLine{155     \textcolor{keyword}{const} \mbox{\hyperlink{structudmaio_1_1_uio_region}{UioRegion}} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}};}
\DoxyCodeLine{156 }
\DoxyCodeLine{157     \textcolor{keyword}{template} <\textcolor{keyword}{typename} access\_w\textcolor{keywordtype}{id}th\_t>}
\DoxyCodeLine{158     \textcolor{keyword}{inline} \textcolor{keyword}{volatile} access\_width\_t* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a005eca71429a1d493d4c5c8256b0f51d}{\_mem\_ptr}}(uint32\_t offs)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{159         \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}access\_width\_t*\textcolor{keyword}{>}(\textcolor{keyword}{static\_cast<}uint8\_t*\textcolor{keyword}{>}(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_abb226e09f75ef2c1cae366f3b30b54c0}{\_access\_mem}}) +}
\DoxyCodeLine{160                                                  \textcolor{keyword}{static\_cast<}ptrdiff\_t\textcolor{keyword}{>}(offs));}
\DoxyCodeLine{161     \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     uint32\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a2489519c2d0a7f616c2f63803dd6e2b2}{\_rd32}}(uint32\_t offs) \textcolor{keyword}{const} \textcolor{keyword}{final} \textcolor{keyword}{override} \{}
\DoxyCodeLine{164         \textcolor{keyword}{const} uint32\_t tmp = *\_mem\_ptr<uint32\_t>(offs);}
\DoxyCodeLine{165         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}}) \{}
\DoxyCodeLine{166             BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{167                 << \textcolor{stringliteral}{"{}0x"{}} << std::hex << offs << \textcolor{stringliteral}{"{} -\/-\/> 0x"{}} << std::setw(\textcolor{keyword}{sizeof}(uint32\_t) * 2)}
\DoxyCodeLine{168                 << std::setfill(\textcolor{charliteral}{'0'}) << tmp << std::dec;}
\DoxyCodeLine{169         \}}
\DoxyCodeLine{170         \textcolor{keywordflow}{return} tmp;}
\DoxyCodeLine{171     \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{173     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a17d858e22ba0c9ac6dc2517c1eb8fcd8}{\_wr32}}(uint32\_t offs, \textcolor{keyword}{const} uint32\_t data) \textcolor{keyword}{final} \textcolor{keyword}{override} \{}
\DoxyCodeLine{174         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}}) \{}
\DoxyCodeLine{175             BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{176                 << \textcolor{stringliteral}{"{}0x"{}} << std::hex << offs << \textcolor{stringliteral}{"{} <-\/-\/ 0x"{}} << std::setw(\textcolor{keyword}{sizeof}(uint32\_t) * 2)}
\DoxyCodeLine{177                 << std::setfill(\textcolor{charliteral}{'0'}) << data << std::dec;}
\DoxyCodeLine{178         \}}
\DoxyCodeLine{179         *\_mem\_ptr<uint32\_t>(offs) = data;}
\DoxyCodeLine{180     \}}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     uint64\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a0e3911204df011f7b0b486ffc5c0645a}{\_rd64}}(uint32\_t offs) \textcolor{keyword}{const} \textcolor{keyword}{final} \textcolor{keyword}{override} \{}
\DoxyCodeLine{183         \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{sizeof}(max\_access\_width\_t) == \textcolor{keyword}{sizeof}(uint64\_t)) \{}
\DoxyCodeLine{184             \textcolor{comment}{// We support native 64-\/bit access}}
\DoxyCodeLine{185             \textcolor{keyword}{const} uint64\_t tmp = *\_mem\_ptr<uint64\_t>(offs);}
\DoxyCodeLine{186             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}}) \{}
\DoxyCodeLine{187                 BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{188                     << \textcolor{stringliteral}{"{}0x"{}} << std::hex << offs << \textcolor{stringliteral}{"{} -\/-\/> 0x"{}} << std::setw(\textcolor{keyword}{sizeof}(uint64\_t) * 2)}
\DoxyCodeLine{189                     << std::setfill(\textcolor{charliteral}{'0'}) << tmp << std::dec;}
\DoxyCodeLine{190             \}}
\DoxyCodeLine{191             \textcolor{keywordflow}{return} tmp;}
\DoxyCodeLine{192         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{193             \textcolor{comment}{// Use default (32-\/bit) implementation}}
\DoxyCodeLine{194             \textcolor{keywordflow}{return} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a9d3e10b75787c569812ad65da4e893c4}{HwAccessor::\_rd64}}(offs);}
\DoxyCodeLine{195         \}}
\DoxyCodeLine{196     \}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ab50a301f77a018dbe51f72464c815d54}{\_wr64}}(uint32\_t offs, \textcolor{keyword}{const} uint64\_t data) \textcolor{keyword}{final} \textcolor{keyword}{override} \{}
\DoxyCodeLine{199         \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (\textcolor{keyword}{sizeof}(max\_access\_width\_t) == \textcolor{keyword}{sizeof}(uint64\_t)) \{}
\DoxyCodeLine{200             \textcolor{comment}{// We support native 64-\/bit access}}
\DoxyCodeLine{201             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}}) \{}
\DoxyCodeLine{202                 BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{203                     << \textcolor{stringliteral}{"{}0x"{}} << std::hex << offs << \textcolor{stringliteral}{"{} <-\/-\/ 0x"{}} << std::setw(\textcolor{keyword}{sizeof}(uint64\_t) * 2)}
\DoxyCodeLine{204                     << std::setfill(\textcolor{charliteral}{'0'}) << data << std::dec;}
\DoxyCodeLine{205             \}}
\DoxyCodeLine{206             *\_mem\_ptr<uint64\_t>(offs) = data;}
\DoxyCodeLine{207         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{208             \textcolor{comment}{// Use default (32-\/bit) implementation}}
\DoxyCodeLine{209             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_ad293ca2045227221a5e7e0f102b7c5e7}{HwAccessor::\_wr64}}(offs, data);}
\DoxyCodeLine{210         \}}
\DoxyCodeLine{211     \}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213     uint32\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a7d00057806e3b9e98e5f4b200dd81b71}{wait\_for\_interrupt}}() final\textcolor{keyword}{ override }\{}
\DoxyCodeLine{214         \textcolor{keyword}{const} \textcolor{keywordtype}{int} fd\_int = \mbox{\hyperlink{classudmaio_1_1_hw_accessor_a97f39c0284f7aa859f034caf0b5ecf1f}{get\_fd\_int}}();}
\DoxyCodeLine{215         uint32\_t irq\_count;}
\DoxyCodeLine{216         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}wait for interrupt ..."{}};}
\DoxyCodeLine{217         \textcolor{keywordflow}{if} (fd\_int < 0) \{}
\DoxyCodeLine{218             BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::fatal) << \textcolor{stringliteral}{"{}fd\_int not set"{}};}
\DoxyCodeLine{219         \}}
\DoxyCodeLine{220         \textcolor{keywordtype}{int} rc = read(fd\_int, \&irq\_count, \textcolor{keyword}{sizeof}(irq\_count));}
\DoxyCodeLine{221         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{222             << \textcolor{stringliteral}{"{}interrupt received, rc = "{}} << rc << \textcolor{stringliteral}{"{}, irq count = "{}} << irq\_count;}
\DoxyCodeLine{223         \textcolor{keywordflow}{return} irq\_count;}
\DoxyCodeLine{224     \}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226   \textcolor{keyword}{public}:}
\DoxyCodeLine{227     \mbox{\hyperlink{structudmaio_1_1_uio_region}{UioRegion}} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a521d0a992a1a281c0f0becafa651f3e4}{get\_phys\_region}}() const final\textcolor{keyword}{ override }\{}
\DoxyCodeLine{228         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} access\_offs =}
\DoxyCodeLine{229             \textcolor{keyword}{static\_cast<}uint8\_t*\textcolor{keyword}{>}(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_abb226e09f75ef2c1cae366f3b30b54c0}{\_access\_mem}}) -\/ \textcolor{keyword}{static\_cast<}uint8\_t*\textcolor{keyword}{>}(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a26b9a4df8e04fb7a6e4748f21c809e7f}{\_mmap\_mem}});}
\DoxyCodeLine{230         \textcolor{keywordflow}{return} \{\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}}.\mbox{\hyperlink{structudmaio_1_1_uio_region_aeae3c222eaf007b2850693dfdfd3af9c}{addr}} + access\_offs, \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a87902e27cd5c8b67bcdc71ce4e7bcfed}{\_region}}.\mbox{\hyperlink{structudmaio_1_1_uio_region_ac820f3588c55f13155345aae9e198a32}{size}} -\/ access\_offs\};}
\DoxyCodeLine{231     \}}
\DoxyCodeLine{232     \textcolor{keywordtype}{void}* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_a096d74608a4499d234ee47a14396ca1a}{get\_virt\_mem}}() const final\textcolor{keyword}{ override }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_abb226e09f75ef2c1cae366f3b30b54c0}{\_access\_mem}}; \}}
\DoxyCodeLine{233 \};}
\DoxyCodeLine{234 }
\DoxyCodeLine{235 \textcolor{comment}{// Hardware accessor for XDMA. Can support either 32 or 64 bit access}}
\DoxyCodeLine{236 \textcolor{keyword}{template} <\textcolor{keyword}{typename} max\_access\_w\textcolor{keywordtype}{id}th\_t>}
\DoxyCodeLine{237 \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma}{HwAccessorXdma}} : \textcolor{keyword}{public} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap}{HwAccessorMmap}}<max\_access\_width\_t> \{}
\DoxyCodeLine{238     \textcolor{keywordtype}{int} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}};}
\DoxyCodeLine{239 }
\DoxyCodeLine{240   \textcolor{keyword}{public}:}
\DoxyCodeLine{241     \textcolor{comment}{// TODO: if we ever have to deal w/ unaligned mappings over XDMA (like on UIO), we'll have to pass an access\_offs to HwAccessorMmap}}
\DoxyCodeLine{242     \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_a5546259c3bad3f88facb0ec91f6bcc4e}{HwAccessorXdma}}(std::string xdma\_path,}
\DoxyCodeLine{243                    std::string evt\_dev,}
\DoxyCodeLine{244                    \mbox{\hyperlink{structudmaio_1_1_uio_region}{UioRegion}} region,}
\DoxyCodeLine{245                    uintptr\_t pcie\_offs)}
\DoxyCodeLine{246         : \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap}{HwAccessorMmap}}<max\_access\_width\_t>(xdma\_path + \textcolor{stringliteral}{"{}/user"{}},}
\DoxyCodeLine{247                                              \{region.\mbox{\hyperlink{structudmaio_1_1_uio_region_aeae3c222eaf007b2850693dfdfd3af9c}{addr}} | pcie\_offs, region.\mbox{\hyperlink{structudmaio_1_1_uio_region_ac820f3588c55f13155345aae9e198a32}{size}}\},}
\DoxyCodeLine{248                                              region.addr,}
\DoxyCodeLine{249                                              0) \{}
\DoxyCodeLine{250         \textcolor{keywordflow}{if} (!evt\_dev.empty()) \{}
\DoxyCodeLine{251             \textcolor{keyword}{const} \textcolor{keyword}{auto} evt\_path = xdma\_path + \textcolor{stringliteral}{"{}/"{}} + evt\_dev;}
\DoxyCodeLine{252             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}} = ::open(evt\_path.c\_str(), O\_RDWR);}
\DoxyCodeLine{253 }
\DoxyCodeLine{254             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}} < 0) \{}
\DoxyCodeLine{255                 \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}could not open "{}} + evt\_path);}
\DoxyCodeLine{256             \}}
\DoxyCodeLine{257             BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{HwAccessor::\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}fd\_int =  "{}} << \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}};}
\DoxyCodeLine{258         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{259             \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}} = -\/1;}
\DoxyCodeLine{260         \}}
\DoxyCodeLine{261     \}}
\DoxyCodeLine{262 }
\DoxyCodeLine{263     \textcolor{keyword}{virtual} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_a37bd577fc7da9fe0c3a33274811321fd}{\string~HwAccessorXdma}}() \{}
\DoxyCodeLine{264         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}} > 0) \{}
\DoxyCodeLine{265             ::close(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}});}
\DoxyCodeLine{266         \}}
\DoxyCodeLine{267     \}}
\DoxyCodeLine{268 }
\DoxyCodeLine{269     \textcolor{keywordtype}{int} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_abde56466e6dfee2f652118ee2ec4d096}{get\_fd\_int}}() const final\textcolor{keyword}{ override }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_xdma_af13a77bce91f00d58b1f0f0fa399f6d8}{\_fd\_int}}; \}}
\DoxyCodeLine{270 \};  \textcolor{comment}{// namespace udmaio}}
\DoxyCodeLine{271 }
\DoxyCodeLine{272 \textcolor{comment}{// Hardware accessor for AXI. Always supports 64 bit access}}
\DoxyCodeLine{273 \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_hw_accessor_axi}{HwAccessorAxi}} : \textcolor{keyword}{public} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap}{HwAccessorMmap}}<uint64\_t> \{}
\DoxyCodeLine{274   \textcolor{keyword}{public}:}
\DoxyCodeLine{275     \mbox{\hyperlink{classudmaio_1_1_hw_accessor_axi_af33cf4c8e8a8cc28f2a884d66b9cb4a6}{HwAccessorAxi}}(std::string dev\_path, \mbox{\hyperlink{structudmaio_1_1_uio_region}{UioRegion}} region, uintptr\_t mmap\_offs, \textcolor{keywordtype}{size\_t} access\_offs);}
\DoxyCodeLine{276     \textcolor{keyword}{virtual} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_axi_a60f2fd333222315babaeef48fc045cb3}{\string~HwAccessorAxi}}();}
\DoxyCodeLine{277 }
\DoxyCodeLine{278     \textcolor{keywordtype}{int} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_axi_a978c83d1898520efa59e88b1f7f8552c}{get\_fd\_int}}() const final\textcolor{keyword}{ override }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}}; \}}
\DoxyCodeLine{279 }
\DoxyCodeLine{280     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_axi_a94c95498bee88282f1beb21a22127f1d}{arm\_interrupt}}() final\textcolor{keyword}{ override }\{}
\DoxyCodeLine{281         uint32\_t mask = 1;}
\DoxyCodeLine{282         \textcolor{keywordtype}{int} rc = write(\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mmap_ae4fd7d9ff21a903af787040ddc36fa91}{\_fd}}, \&mask, \textcolor{keyword}{sizeof}(mask));}
\DoxyCodeLine{283         BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{HwAccessor::\_lg}}, bls::trace) << \textcolor{stringliteral}{"{}arm interrupt enable, ret code = "{}} << rc;}
\DoxyCodeLine{284     \}}
\DoxyCodeLine{285 \};}
\DoxyCodeLine{286 }
\DoxyCodeLine{287 \textcolor{comment}{// Base class for mock hardware (for unit tests)}}
\DoxyCodeLine{288 \textcolor{keyword}{class }\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock}{HwAccessorMock}} : \textcolor{keyword}{public} \mbox{\hyperlink{classudmaio_1_1_hw_accessor}{HwAccessor}} \{}
\DoxyCodeLine{289     \textcolor{keyword}{mutable} std::vector<uint8\_t> \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a1fadc1f4fcf69995c8af371b455b58ac}{\_mem}};}
\DoxyCodeLine{290 }
\DoxyCodeLine{291   \textcolor{keyword}{public}:}
\DoxyCodeLine{292     \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_ab2cb4b1ef325ed48edaf4812ae084d64}{HwAccessorMock}}(\textcolor{keywordtype}{size\_t} mem\_size) : \mbox{\hyperlink{classudmaio_1_1_hw_accessor}{HwAccessor}}\{\}, \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a1fadc1f4fcf69995c8af371b455b58ac}{\_mem}}(mem\_size, 0) \{\}}
\DoxyCodeLine{293 }
\DoxyCodeLine{294     \textcolor{keyword}{virtual} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_ad86fddb31a43ed5db94c74e32ef6ffab}{\string~HwAccessorMock}}() \{\}}
\DoxyCodeLine{295 }
\DoxyCodeLine{296   \textcolor{keyword}{protected}:}
\DoxyCodeLine{297     \textcolor{keyword}{template} <\textcolor{keyword}{typename} access\_w\textcolor{keywordtype}{id}th\_t>}
\DoxyCodeLine{298     \textcolor{keyword}{inline} \textcolor{keyword}{volatile} access\_width\_t* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a7be7afe571251c079078d86064de0d78}{\_mem\_ptr}}(uint32\_t offs)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{299         \textcolor{keywordflow}{if} (offs + \textcolor{keyword}{sizeof}(access\_width\_t) > \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a1fadc1f4fcf69995c8af371b455b58ac}{\_mem}}.size()) \{}
\DoxyCodeLine{300             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Buffer overflow ("{}} + std::to\_string(\textcolor{keyword}{sizeof}(access\_width\_t)) +}
\DoxyCodeLine{301                                      \textcolor{stringliteral}{"{} bytes at "{}} + std::to\_string(offs) + \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{302         \}}
\DoxyCodeLine{303         \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}access\_width\_t*\textcolor{keyword}{>}(\&\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a1fadc1f4fcf69995c8af371b455b58ac}{\_mem}}[offs]);}
\DoxyCodeLine{304     \}}
\DoxyCodeLine{305 }
\DoxyCodeLine{306     uint32\_t \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a230b44dddf8399f240d13587d57a0b9f}{\_rd32}}(uint32\_t offs) \textcolor{keyword}{const} \textcolor{keyword}{final} \textcolor{keyword}{override} \{}
\DoxyCodeLine{307         \textcolor{keyword}{const} uint32\_t tmp = *\_mem\_ptr<uint32\_t>(offs);}
\DoxyCodeLine{308         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}}) \{}
\DoxyCodeLine{309             BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{310                 << \textcolor{stringliteral}{"{}0x"{}} << std::hex << offs << \textcolor{stringliteral}{"{} -\/-\/> 0x"{}} << std::setw(\textcolor{keyword}{sizeof}(uint32\_t) * 2)}
\DoxyCodeLine{311                 << std::setfill(\textcolor{charliteral}{'0'}) << tmp << std::dec;}
\DoxyCodeLine{312         \}}
\DoxyCodeLine{313         \textcolor{keywordflow}{return} tmp;}
\DoxyCodeLine{314     \}}
\DoxyCodeLine{315 }
\DoxyCodeLine{316     \textcolor{keywordtype}{void} \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_af6b3b4998c3ace3cbd79622c6fba8f71}{\_wr32}}(uint32\_t offs, \textcolor{keyword}{const} uint32\_t data) \textcolor{keyword}{final} \textcolor{keyword}{override} \{}
\DoxyCodeLine{317         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classudmaio_1_1_hw_accessor_a8b7c51c0fcdf2daeac15526ebaf6ebe4}{\_debug\_enable}}) \{}
\DoxyCodeLine{318             BOOST\_LOG\_SEV(\mbox{\hyperlink{structudmaio_1_1_logger_a1779913e9d83c27fa0d7ea1ff056b403}{\_lg}}, bls::trace)}
\DoxyCodeLine{319                 << \textcolor{stringliteral}{"{}0x"{}} << std::hex << offs << \textcolor{stringliteral}{"{} <-\/-\/ 0x"{}} << std::setw(\textcolor{keyword}{sizeof}(uint32\_t) * 2)}
\DoxyCodeLine{320                 << std::setfill(\textcolor{charliteral}{'0'}) << data << std::dec;}
\DoxyCodeLine{321         \}}
\DoxyCodeLine{322         *\_mem\_ptr<uint32\_t>(offs) = data;}
\DoxyCodeLine{323     \}}
\DoxyCodeLine{324 }
\DoxyCodeLine{325     \textcolor{keywordtype}{void}* \mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a2e264cb9f86246486a4117d6cf3f565c}{get\_virt\_mem}}() const final\textcolor{keyword}{ override }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\&\mbox{\hyperlink{classudmaio_1_1_hw_accessor_mock_a1fadc1f4fcf69995c8af371b455b58ac}{\_mem}}[0]); \}}
\DoxyCodeLine{326 \};}
\DoxyCodeLine{327 }
\DoxyCodeLine{328 \}  \textcolor{comment}{// namespace udmaio}}

\end{DoxyCode}
